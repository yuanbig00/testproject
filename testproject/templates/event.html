{% load staticfiles %}
{% load showchart_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>微热点事件舆情数据库</title>
    <link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.css">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static 'js/echarts/echarts.min.js' %}">
    <link rel="stylesheet" href="{% static 'js/china.js' %}">
    <script type="text/javascript" src="https://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.2.1-rc1/echarts.min.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=Fecupnw0DjRBcnuRrTNyaW0g4DN1Ta18"></script>
</head>

<body>
    <div class="header">
        热点事件舆情数据库
    </div>
    <div class="main clearfix"></div>
    <h3 class="title">{{event_list.name}}</h3>

    <div class="main-middle">
        <div class="border-container">
            <div class="name-title">
                事件简介：
            </div>
            <p class="brief">{{event_list.brief}}</p>
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>

    </div>
    <div class="main-middle">
        <div class="border-container">
            <div class="name-title">
                趋势图（按小时显示）
            </div>
            <div id="testchart" style="height: 300px; padding:10px; margin:0% auto;">
                <script type="text/javascript">
                    var testchart = echarts.init(document.getElementById('testchart'));
                    option = {
                        xAxis: {
                            type: 'category',
                            data: ['{{event_list.create_time|date:"m-d"}}， 0:00', '{{event_list.create_time|date:"m-d"}}，3:00', '{{event_list.create_time|date:"m-d"}}，6:00', '{{event_list.create_time|date:"m-d"}}，9:00', '{{event_list.create_time|date:"m-d"}}，12:00', '{{event_list.create_time|date:"m-d"}}，15:00', '{{event_list.create_time|date:"m-d"}}，18:00'],
                            axisLine: {
                                lineStyle: {
                                    color: '#fafafa',
                                }
                            },
                        },
                        yAxis: {
                            type: 'value',
                            axisLine: {
                                lineStyle: {
                                    color: '#fafafa',
                                }
                            },
                        },
                        series: [{
                            data: [0, 35, 28, 120, 112, 153, 140],
                            type: 'line',
                            smooth: true
                        }],
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [{
                                offset: 0,
                                color: 'red' // 0% 处的颜色
                            }, {
                                offset: 1,
                                color: 'orange' // 100% 处的颜色
                            }],
                            global: false // 缺省为 false
                        }

                    };

                    testchart.setOption(option);
                </script>
            </div>
            <table class="table table-kingdargen2">
                <tbody>
                    <tr>
                        <td>持续时间</td>
                        <td>3天16小时</td>
                    </tr>
                    <tr>
                        <td>过去24小时传播速度</td>
                        <td>35条/小时</td>
                    </tr>
                    <tr>
                        <td>峰值传播速度</td>
                        <td>164条/小时</td>
                    </tr>
                </tbody>
            </table>
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>
    <div class="main-middle">
        <div class="border-container">
            <div class="name-title">
                传播调性分析
            </div>
            <div id="graduateyear" style="height: 300px; padding:10px; margin:0% auto;">
                <script>
                    var professionrate = echarts.init(document.getElementById('graduateyear'));
                    option = {

                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: ['正面', '负面', '中性'],
                            textStyle: {
                                color: '#fafafa',
                            },

                        },
                        series: [{
                            name: '调性',
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data: [{
                                value: 335,
                                name: '正面'
                            }, {
                                value: 310,
                                name: '负面'
                            }, {
                                value: 234,
                                name: '中性'
                            }, ],
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 245, 255, 0.5)'
                                }
                            }

                        }]
                    };

                    professionrate.setOption(option);
                </script>
            </div>
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>
    <div class="main-middle">
        <div class="border-container">
            <div class="name-title">
                传播方式分析
            </div>
            <div id="chartmain" style="width:850px; height: 300px; padding: 10px;margin:70px auto;"></div>
            <script>
                var option = {
                    dataset: {
                        source: [
                            ['amount', 'product'],
                            [58212, '评论数'],
                            [78254, '转发数'],
                            [41032, '点赞数'],

                        ]
                    },
                    grid: {
                        containLabel: true
                    },
                    xAxis: {
                        name: 'amount',
                        axisLine: {
                            lineStyle: {
                                color: '#fafafa',

                            }
                        },
                    },
                    yAxis: {
                        type: 'category',
                        axisLine: {
                            lineStyle: {
                                color: '#fafafa',
                            }
                        },
                    },
                    visualMap: {
                        orient: 'horizontal',
                        left: 'center',
                        min: 1,
                        max: 100000,
                        textStyle: {
                            fontSize: '15',
                            fontWeight: 'bold',
                        },
                        text: ['高', '低'],
                        // Map the score column to color
                        dimension: 0,
                        inRange: {
                            color: ['#00ffff', '#132b88']
                        }
                    },
                    series: [{
                        type: 'bar',
                        encode: {
                            // Map the "amount" column to X axis.
                            x: 'amount',
                            // Map the "product" column to Y axis
                            y: 'product'
                        }
                    }]
                };
                //初始化echarts实例
                var myChart = echarts.init(document.getElementById('chartmain'));

                //使用制定的配置项和数据显示图表
                myChart.setOption(option);
            </script>

            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>
    <div class="main-left">
        <div class="border-container ">
            <div class="main-title">
                人物画像
            </div>
        </div>
        <div class="border-container">
            <div class="name-title">
                性别
            </div>
            <div id="people" style="width:300px; height: 350px; padding: 10px;margin:70px auto;"></div>
            <script>
                var symbols = [
                    'path://M18.2629891,11.7131596 L6.8091608,11.7131596 C1.6685112,11.7131596 0,13.032145 0,18.6237673 L0,34.9928467 C0,38.1719847 4.28388932,38.1719847 4.28388932,34.9928467 L4.65591984,20.0216948 L5.74941883,20.0216948 L5.74941883,61.000787 C5.74941883,65.2508314 11.5891201,65.1268798 11.5891201,61.000787 L11.9611506,37.2137775 L13.1110872,37.2137775 L13.4831177,61.000787 C13.4831177,65.1268798 19.3114787,65.2508314 19.3114787,61.000787 L19.3114787,20.0216948 L20.4162301,20.0216948 L20.7882606,34.9928467 C20.7882606,38.1719847 25.0721499,38.1719847 25.0721499,34.9928467 L25.0721499,18.6237673 C25.0721499,13.032145 23.4038145,11.7131596 18.2629891,11.7131596 M12.5361629,1.11022302e-13 C15.4784742,1.11022302e-13 17.8684539,2.38997966 17.8684539,5.33237894 C17.8684539,8.27469031 15.4784742,10.66467 12.5361629,10.66467 C9.59376358,10.66467 7.20378392,8.27469031 7.20378392,5.33237894 C7.20378392,2.38997966 9.59376358,1.11022302e-13 12.5361629,1.11022302e-13',
                    'path://M28.9624207,31.5315864 L24.4142575,16.4793596 C23.5227152,13.8063773 20.8817445,11.7111088 17.0107398,11.7111088 L12.112691,11.7111088 C8.24168636,11.7111088 5.60080331,13.8064652 4.70917331,16.4793596 L0.149791395,31.5315864 C-0.786976655,34.7595013 2.9373074,35.9147532 3.9192135,32.890727 L8.72689855,19.1296485 L9.2799493,19.1296485 C9.2799493,19.1296485 2.95992025,43.7750224 2.70031069,44.6924335 C2.56498417,45.1567684 2.74553639,45.4852068 3.24205501,45.4852068 L8.704461,45.4852068 L8.704461,61.6700801 C8.704461,64.9659872 13.625035,64.9659872 13.625035,61.6700801 L13.625035,45.360657 L15.5097899,45.360657 L15.4984835,61.6700801 C15.4984835,64.9659872 20.4191451,64.9659872 20.4191451,61.6700801 L20.4191451,45.4852068 L25.8814635,45.4852068 C26.3667633,45.4852068 26.5586219,45.1567684 26.4345142,44.6924335 C26.1636859,43.7750224 19.8436568,19.1296485 19.8436568,19.1296485 L20.3966199,19.1296485 L25.2043926,32.890727 C26.1862111,35.9147532 29.9105828,34.7595013 28.9625083,31.5315864 L28.9624207,31.5315864 Z M14.5617154,0 C17.4960397,0 19.8773132,2.3898427 19.8773132,5.33453001 C19.8773132,8.27930527 17.4960397,10.66906 14.5617154,10.66906 C11.6274788,10.66906 9.24611767,8.27930527 9.24611767,5.33453001 C9.24611767,2.3898427 11.6274788,0 14.5617154,0 L14.5617154,0 Z',
                    'path://M512 292.205897c80.855572 0 146.358821-65.503248 146.358821-146.358821C658.358821 65.503248 592.855572 0 512 0 431.144428 0 365.641179 65.503248 365.641179 146.358821 365.641179 227.214393 431.144428 292.205897 512 292.205897zM512 731.282359c-80.855572 0-146.358821 65.503248-146.358821 146.358821 0 80.855572 65.503248 146.358821 146.358821 146.358821 80.855572 0 146.358821-65.503248 146.358821-146.358821C658.358821 796.273863 592.855572 731.282359 512 731.282359z'
                ];
                var bodyMax = 100; //指定图形界限的值
                var labelSetting = {
                    normal: {
                        show: true,
                        position: 'bottom',
                        offset: [0, 10],
                        formatter: function(param) {
                            return (param.value / bodyMax * 100).toFixed(0) + '%';
                        },
                        textStyle: {
                            fontSize: 18,
                            fontFamily: 'Arial',
                            color: '#686868'
                        }
                    }
                };

                var markLineSetting = { //设置标线
                    symbol: 'none',
                    lineStyle: {
                        normal: {
                            opacity: 0.3
                        }
                    },
                    data: [{
                        type: 'max',
                        label: {
                            normal: {
                                formatter: 'max: {c}'
                            }
                        }
                    }, {
                        type: 'min',
                        label: {
                            normal: {
                                formatter: 'min: {c}'
                            }
                        }
                    }]
                };

                option = {
                        tooltip: {
                            show: false, //鼠标放上去显示悬浮数据
                        },
                        legend: {
                            data: ['typeA', 'typeB'],
                            selectedMode: 'single',
                            itemWidth: 10, //图例的宽度
                            itemHeight: 10, //图例的高度
                            itemGap: 30,
                            orient: 'horizontal',
                            left: 'center',
                            top: '20px',
                            icon: 'rect',
                            // selectedMode: false, //取消图例上的点击事件
                            textStyle: {
                                color: '#808492'
                            },
                        },
                        grid: {
                            // left: '20%',
                            // right: '20%',
                            top: '20%',
                            bottom: '20%',
                            containLabel: true
                        },
                        xAxis: {
                            data: ['a', 'x', 'b'],
                            axisTick: {
                                show: false
                            },
                            axisLine: {
                                show: false
                            },
                            axisLabel: {
                                show: false
                            }
                        },
                        yAxis: {
                            max: bodyMax,
                            splitLine: {
                                show: false
                            },
                            axisTick: {
                                // 刻度线
                                show: false
                            },
                            axisLine: {
                                // 轴线
                                show: false
                            },
                            axisLabel: {
                                // 轴坐标文字
                                show: false
                            }
                        },
                        series: [{

                                type: 'pictorialBar',
                                symbolClip: true,
                                symbolBoundingData: bodyMax,
                                label: labelSetting,
                                data: [{
                                    value: 35,
                                    symbol: symbols[0],
                                    itemStyle: {
                                        normal: {
                                            color: 'rgba(105,204,230)' //单独控制颜色
                                        }
                                    },
                                }, {

                                }, {
                                    value: 65,
                                    symbol: symbols[1],
                                    itemStyle: {
                                        normal: {
                                            color: 'rgba(255,130,130)' //单独控制颜色
                                        }
                                    },
                                }],
                                // markLine: markLineSetting,
                                z: 10
                            },

                            {
                                // 设置背景底色，不同的情况用这个
                                name: 'full',
                                type: 'pictorialBar', //异型柱状图 图片、SVG PathData
                                symbolBoundingData: bodyMax,
                                animationDuration: 0,
                                itemStyle: {
                                    normal: {
                                        color: '#ccc' //设置全部颜色，统一设置
                                    }
                                },
                                z: 10,
                                data: [{
                                    itemStyle: {
                                        normal: {
                                            color: 'rgba(105,204,230,0.40)' //单独控制颜色
                                        }
                                    },
                                    value: 100,
                                    symbol: symbols[0]
                                }, {
                                    // 设置中间冒号
                                    itemStyle: {
                                        normal: {
                                            color: '#1DA1F2' //单独控制颜色
                                        }
                                    },
                                    value: 100,
                                    symbol: symbols[2],
                                    symbolSize: [8, '18%'],
                                    symbolOffset: [0, '-200%']
                                }, {
                                    itemStyle: {
                                        normal: {
                                            color: 'rgba(255,130,130,0.40)' //单独控制颜色
                                        }
                                    },
                                    value: 100,
                                    symbol: symbols[1]
                                }]
                            }
                        ]
                    }
                    //初始化echarts实例
                var myChart = echarts.init(document.getElementById('people'));

                //使用制定的配置项和数据显示图表
                myChart.setOption(option);
            </script>

            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>

    <div class="main-right">
        <div class="border-container">
            <div class="name-title">
                地域分析
            </div>
            <div id="eara" style="width:510px; height: 470px; padding: 10px;margin:10px auto;"></div>
            <script>
                var data = [{
                        name: "上海",
                        value: 2978
                    }, {
                        name: "珠海",
                        value: 2186
                    }, {
                        name: "三亚",
                        value: 1135
                    }, {
                        name: "惠州",
                        value: 1973
                    }, {
                        name: "海口",
                        value: 2568
                    }, {
                        name: "合肥",
                        value: 4039
                    }, {
                        name: "南京",
                        value: 6959
                    }, {
                        name: "杭州",
                        value: 5632
                    }, {
                        name: "苏州",
                        value: 6707
                    }, {
                        name: "无锡",
                        value: 3393
                    },
                    // { name: "昆山", value: 1894},
                    // { name: "广州", value: 15769},
                    // { name: "深圳", value: 8259},
                    // { name: "佛山", value: 5741},
                    // { name: "东莞", value: 3030},
                    // { name: "福州", value: 4542},
                    // { name: "厦门", value: 3329},
                    // { name: "南宁", value: 3157},
                    // { name: "郑州", value: 6690},
                    // { name: "武汉", value: 8678},
                    // { name: "长沙", value: 5303},
                    // { name: "南昌", value: 3025},
                    // { name: "北京", value: 20259},
                    // { name: "长春", value: 3016},
                    // { name: "大连", value: 3202},
                    // { name: "沈阳", value: 4540},
                    // { name: "哈尔滨", value: 3141},
                    // { name: "天津", value: 8626},
                    // { name: "济南", value: 4361},
                    // { name: "青岛", value: 6667},
                    // { name: "太原", value: 4080},
                    // { name: "石家庄", value: 6137},
                    // { name: "西安", value: 6991},
                    // { name: "成都", value: 13873},
                    // { name: "重庆", value: 13283},
                    // { name: "昆明", value: 4633},


                ];

                var geoCoordMap = {
                    "上海": [121.48, 31.22],
                    "珠海": [113.52, 22.3],
                    "三亚": [109.31, 18.14],
                    "惠州": [114.4, 23.09],
                    "海口": [110.35, 20.02],
                    "合肥": [117.27, 31.86],
                    "南京": [118.78, 32.04],
                    "杭州": [120.19, 30.26],
                    "苏州": [120.62, 31.32],
                    "无锡": [120.29, 31.59],
                    "昆山": [120.95, 31.39],
                    "广州": [113.23, 23.16],
                    "深圳": [114.07, 22.62],
                    "佛山": [113.11, 23.05],
                    "东莞": [113.75, 23.04],
                    "福州": [119.3, 26.08],
                    "厦门": [118.1, 24.46],
                    "南宁": [108.33, 22.84],
                    "郑州": [113.65, 34.76],
                    "武汉": [114.31, 30.52],
                    "长沙": [113, 28.21],
                    "南昌": [115.89, 28.68],
                    "北京": [116.46, 39.92],
                    "长春": [125.35, 43.88],
                    "大连": [121.62, 38.92],
                    "沈阳": [123.38, 41.8],
                    "哈尔滨": [126.63, 45.75],
                    "天津": [117.2, 39.13],
                    "济南": [117, 36.65],
                    "青岛": [120.33, 36.07],
                    "太原": [112.53, 37.87],
                    "石家庄": [114.48, 38.03],
                    "西安": [108.95, 34.27],
                    "成都": [104.06, 30.67],
                    "重庆": [106.54, 29.59],
                    "昆明": [102.73, 25.04],
                };

                var convertData = function(data) {
                    var res = [];
                    for (var i = 0; i < data.length; i++) {
                        var geoCoord = geoCoordMap[data[i].name];
                        if (geoCoord) {
                            res.push({
                                name: data[i].name,
                                value: geoCoord.concat(data[i].value)
                            });
                        }
                    }
                    return res;
                };

                var convertedData = [
                    convertData(data),
                    convertData(data.sort(function(a, b) {
                        return b.value - a.value;
                    }).slice(0, 6))
                ];
                data.sort(function(a, b) {
                    return a.value - b.value;
                })

                var selectedItems = [];
                var categoryData = [];
                var barData = [];
                //   var maxBar = 30;
                var sum = 0;
                var count = data.length;
                for (var i = 0; i < data.length; i++) {
                    categoryData.push(data[i].name);
                    barData.push(data[i].value);
                    sum += data[i].value;
                }
                console.log(categoryData);
                console.log(sum + "   " + count)
                option = {
                    backgroundColor: '#040f3c',
                    animation: true,
                    animationDuration: 1000,
                    animationEasing: 'cubicInOut',
                    animationDurationUpdate: 1000,
                    animationEasingUpdate: 'cubicInOut',
                    // title: [{
                    //     text: '全国36城“无人区”数',
                    //     link: 'http://pages.anjuke.com/expert/newexpert.html',
                    //     subtext: 'data from Anjuke',
                    //     sublink: 'http://pages.anjuke.com/expert/newexpert.html',
                    //     left: 'center',
                    //     textStyle: {
                    //         color: '#fff'
                    //     }
                    // }, {
                    //     id: 'statistic',
                    //     text: count ? '平均: ' + parseInt((sum / count).toFixed(4)) : '',
                    //     right: 120,
                    //     top: 40,
                    //     width: 100,
                    //     textStyle: {
                    //         color: '#fff',
                    //         fontSize: 16
                    //     }
                    // }],
                    toolbox: {
                        iconStyle: {
                            normal: {
                                borderColor: '#fff'
                            },
                            emphasis: {
                                borderColor: '#b1e4ff'
                            }
                        },
                        feature: {
                            dataZoom: {},
                            brush: {
                                type: ['rect', 'polygon', 'clear']
                            },
                            saveAsImage: {
                                show: true
                            }
                        }
                    },
                    brush: {
                        outOfBrush: {
                            color: '#abc'
                        },
                        brushStyle: {
                            borderWidth: 2,
                            color: 'rgba(0,0,0,0.2)',
                            borderColor: 'rgba(0,0,0,0.5)',
                        },
                        seriesIndex: [0, 1],
                        throttleType: 'debounce',
                        throttleDelay: 300,
                        geoIndex: 0
                    },
                    geo: {
                        map: 'china',
                        left: '3',
                        right: '60%',
                        center: [100, 30],
                        zoom: 1.7,
                        label: {
                            emphasis: {
                                show: false
                            }
                        },
                        roam: true,
                        itemStyle: {
                            normal: {
                                areaColor: '#132b88',
                                borderColor: 'rgba(105,204,230)'
                            },
                            emphasis: {
                                areaColor: '#2a333d'
                            }
                        }
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    grid: {
                        right: 10,
                        top: 90,
                        bottom: 40,
                        width: '30%'
                    },
                    xAxis: {
                        type: 'value',
                        scale: true,
                        position: 'top',
                        boundaryGap: false,
                        splitLine: {
                            show: false
                        },
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            margin: 2,
                            textStyle: {
                                color: '#aaa'
                            }
                        },
                    },
                    yAxis: {
                        type: 'category',
                        //  name: 'TOP 20',
                        nameGap: 16,
                        axisLine: {
                            show: true,
                            lineStyle: {
                                color: '#ddd'
                            }
                        },
                        axisTick: {
                            show: false,
                            lineStyle: {
                                color: '#ddd'
                            }
                        },
                        axisLabel: {
                            interval: 0,
                            textStyle: {
                                color: '#ddd'
                            }
                        },
                        data: categoryData
                    },
                    series: [{
                        // name: 'pm2.5',
                        type: 'scatter',
                        coordinateSystem: 'geo',
                        data: convertedData[0],
                        symbolSize: function(val) {
                            return Math.max(val[2] / 300, 8);
                        },
                        label: {
                            normal: {
                                formatter: '{b}',
                                position: 'right',
                                show: false
                            },
                            emphasis: {
                                show: true
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#FF8C00', //光圈颜色
                                position: 'right',
                                show: true
                            }
                        }
                    }, {
                        //  name: 'Top 5',
                        type: 'effectScatter',
                        coordinateSystem: 'geo',
                        data: convertedData[0],
                        symbolSize: function(val) {
                            return Math.max(val[2] / 500, 8);
                        },
                        showEffectOn: 'render',
                        rippleEffect: {
                            brushType: 'stroke'
                        },
                        hoverAnimation: true,
                        label: {
                            normal: {
                                formatter: '{b}',
                                position: 'right',
                                show: true
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#f4e925', //内置颜色
                                shadowBlur: 50,
                                shadowColor: '#EE0000'
                            }
                        },
                        zlevel: 1
                    }, {
                        id: 'bar',
                        zlevel: 2,
                        type: 'bar',
                        symbol: 'none',
                        itemStyle: {
                            normal: {
                                color: '#ddb926'
                            }
                        },

                        data: data //条形图
                    }]
                };



                function renderBrushed(params) {
                    var mainSeries = params.batch[0].selected[0];

                    var selectedItems = [];
                    var categoryData = [];
                    var barData = [];
                    var maxBar = 30;
                    var sum = 0;
                    var count = 0;

                    for (var i = 0; i < mainSeries.dataIndex.length; i++) {
                        var rawIndex = mainSeries.dataIndex[i];
                        var dataItem = convertedData[0][rawIndex];
                        var pmValue = dataItem.value[2];

                        sum += pmValue;
                        count++;

                        selectedItems.push(dataItem);
                    }

                    selectedItems.sort(function(a, b) {
                        //   return b.value[2] - a.value[2];
                        return a.value - b.value;
                    });

                    for (var i = 0; i < Math.min(selectedItems.length, maxBar); i++) {
                        categoryData.push(selectedItems[i].name);
                        barData.push(selectedItems[i].value[2]);
                    }

                    this.setOption({
                        yAxis: {
                            data: categoryData
                        },
                        xAxis: {
                            axisLabel: {
                                show: !!count
                            }
                        },
                        title: {
                            id: 'statistic',
                            text: count ? '平均: ' + (sum / count).toFixed(4) : ''
                        },
                        series: {
                            id: 'bar',
                            //        sort:'descending',
                            data: barData
                        }
                    });
                }
                //初始化echarts实例
                var myChart = echarts.init(document.getElementById('eara'));


                //使用制定的配置项和数据显示图表
                myChart.setOption(option);
            </script>

            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>
    <div class="clear"></div>

    <div class="main-middle">
        <div class="border-container">
            <div class="name-title">
                标签
            </div>
            <div id="tag" style="width:600px; height: 400px;padding-bottom: 40px;margin:10px auto;"></div>
            <script>
                var myChart = echarts.init(document.getElementById('tag'));

                data = [{
                    "value": 17.6,
                    "name": "时尚",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 16.5,
                    "name": "听歌",
                    itemStyle: {
                        normal: {
                            color: '##419aff',
                        }
                    }
                }, {
                    "value": 16.5,
                    "name": "旅行",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 15.5,
                    "name": "旅游",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 14.8,
                    "name": "音乐",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 13.7,
                    "name": "美食",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 13.6,
                    "name": "幽默",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 13.4,
                    "name": "教育",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 13.1,
                    "name": "摄影",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12.6,
                    "name": "自由",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12.6,
                    "name": "体育",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12.6,
                    "name": "文学",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12.4,
                    "name": "公益",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12.2,
                    "name": "创业",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12,
                    "name": "信息",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 12,
                    "name": "宅",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 11.7,
                    "name": "电子商务",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 11.6,
                    "name": "环境",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 11.6,
                    "name": "安全",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }, {
                    "value": 11.6,
                    "name": "历史",
                    itemStyle: {
                        normal: {
                            color: '#419aff',
                        }
                    }
                }]

                for (var n in data) {
                    data[n]['name'] = data[n]['name'] + ' ' + data[n]['value'] + '%'
                }

                option = {

                    tooltip: {
                        trigger: 'item',
                        formatter: "{b}"
                    },
                    series: [{
                        type: 'treemap',
                        width: '100%',
                        height: '85%',
                        top: '15%',
                        roam: false, //是否开启拖拽漫游（移动和缩放）
                        nodeClick: false, //点击节点后的行为,false无反应
                        breadcrumb: {
                            show: false
                        },
                        label: { //描述了每个矩形中，文本标签的样式。
                            normal: {
                                show: true,
                                position: ['10%', '40%']
                            }
                        },

                        itemStyle: {

                            normal: {

                                show: true,
                                textStyle: {
                                    color: '#040f3c',
                                    fontSize: 20,
                                },

                                borderWidth: 1,
                                borderColor: '#fff',
                            },

                            emphasis: {
                                label: {
                                    show: true
                                }
                            }
                        },
                        data: data
                    }]
                };
                myChart.setOption(option, true);

                // 点击事件

                //初始化echarts实例

                //使用制定的配置项和数据显示图表
                myChart.setOption(option);
            </script>

            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>
    <div class="main-middle">
        <div class="border-container">
            <div class="name-title">
                渠道参与情况
            </div>
            <div id="join" style="height: 300px; padding:10px; margin:0% auto;">
                <script>
                    var professionrate = echarts.init(document.getElementById('join'));
                    var colorArray = [{
                            top: '#ffa800', //黄
                            bottom: 'rgba(11,42,84,.3)'
                        },
                        // {
                        //     top: '#1ace4a', //绿
                        //     bottom: 'rgba(11,42,84, 0.3)'
                        // }, 
                        {
                            top: '#4bf3ff', //蓝
                            bottom: 'rgba(11,42,84,.3)'
                        }, {
                            top: '#4f9aff', //深蓝
                            bottom: 'rgba(11,42,84,.3)'
                        },
                        // {
                        //     top: '#b250ff', //粉
                        //     bottom: 'rgba(11,42,84,.3)'
                        // }
                    ];
                    option = {
                        backgroundColor: '#040f3c',
                        tooltip: {
                            show: true,
                            formatter: "{b}:{c}"
                        },
                        grid: {
                            left: '5%',
                            top: '12%',
                            right: '1%',
                            bottom: '8%',
                            containLabel: true
                        },

                        xAxis: {
                            type: 'value',
                            show: false,
                            position: 'top',
                            axisTick: {
                                show: false
                            },
                            axisLine: {
                                show: false,
                                lineStyle: {
                                    color: '#fff',
                                }
                            },
                            splitLine: {
                                show: false
                            },
                        },
                        yAxis: [{
                                type: 'category',
                                axisTick: {
                                    show: false,
                                    alignWithLabel: false,
                                    length: 5,

                                },
                                "splitLine": { //网格线
                                    "show": false
                                },
                                inverse: 'true', //排序
                                axisLine: {
                                    show: false,
                                    lineStyle: {
                                        color: '#fff',
                                    }
                                },
                                data: ['央级媒体', '财经类媒体', '科技类媒体']
                            }

                        ],
                        series: [{
                                name: '百分比',
                                type: 'bar',
                                label: {
                                    normal: {
                                        show: true,
                                        position: 'right',
                                        formatter: '{c}',
                                        textStyle: {
                                            color: 'white' //color of value
                                        }
                                    }
                                },
                                itemStyle: {
                                    normal: {
                                        show: true,
                                        color: function(params) {
                                            let num = colorArray.length;
                                            return {
                                                type: 'linear',
                                                colorStops: [{
                                                    offset: 0,
                                                    color: colorArray[params.dataIndex % num].bottom
                                                }, {
                                                    offset: 1,
                                                    color: colorArray[params.dataIndex % num].top
                                                }, {
                                                    offset: 0,
                                                    color: colorArray[params.dataIndex % num].bottom
                                                }, {
                                                    offset: 1,
                                                    color: colorArray[params.dataIndex % num].top
                                                }, {
                                                    offset: 0,
                                                    color: colorArray[params.dataIndex % num].bottom
                                                }, {
                                                    offset: 1,
                                                    color: colorArray[params.dataIndex % num].top
                                                }, {
                                                    offset: 0,
                                                    color: colorArray[params.dataIndex % num].bottom
                                                }, {
                                                    offset: 1,
                                                    color: colorArray[params.dataIndex % num].top
                                                }, {
                                                    offset: 0,
                                                    color: colorArray[params.dataIndex % num].bottom
                                                }, {
                                                    offset: 1,
                                                    color: colorArray[params.dataIndex % num].top
                                                }, {
                                                    offset: 0,
                                                    color: colorArray[params.dataIndex % num].bottom
                                                }, {
                                                    offset: 1,
                                                    color: colorArray[params.dataIndex % num].top
                                                }],
                                                //globalCoord: false
                                            }
                                        },
                                        barBorderRadius: 70,
                                        borderWidth: 0,
                                        borderColor: '#333',
                                    }
                                },
                                barGap: '0%',
                                barCategoryGap: '50%',
                                data: [60, 132, 89]
                            }

                        ]
                    };

                    professionrate.setOption(option);
                </script>
            </div>
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>

        </div>
    </div>
</body>

</html>